# Ralph Progress Log
Started: 2026-01-31

## Codebase Patterns

### Svelte 5 Runes
- Use `let x = $state(0)` for reactive state, not `let x = 0`
- Use `$effect(() => { ... })` for side effects, not `$: { ... }`
- Props: `let { prop } = $props()` not `export let prop`

### GSAP Integration
- MUST dynamically import in onMount to avoid SSR errors
- Example: `const gsap = (await import('gsap')).default`
- Use GSAP context for cleanup: `ctx = gsap.context(() => { ... })`
- Call `ctx.revert()` in onDestroy to prevent memory leaks

### Tailwind v4
- Config is in `src/app.css` using `@theme` block, NOT tailwind.config.js
- Brand colors: `--color-nbrs-green: #4fa64f`
- Use classes like `bg-nbrs-green`, `text-nbrs-green`

### Page Transitions
- Use Svelte `#key` block with `data.pathname` in +layout.svelte
- `+layout.ts` provides pathname via load function
- Nav and Footer stay OUTSIDE #key block (persist during transitions)

### Component Patterns
- Rollover.svelte: Text slide animation, requires parent `group` class
- Logo.svelte: variant prop for 'color' or 'white'
- SocialIcons.svelte: LinkedIn, X, Instagram links

### Build Requirements
- `npm run build` MUST pass (adapter-static for Cloudflare Pages)
- All routes must exist or build fails
- Videos should be < 5MB, WebM primary, MP4 fallback

### Reference Sites
- Design reference: https://www.americanhousing.co/
- Brand assets: https://nbrs.ca (videos on Cloudinary)

### GSAP Utility Pattern (from PHASE3-01)
- Use `useGsap` action from `$lib/utils/gsap` for GSAP animations
- Action signature: `use:useGsap={(gsap, el) => { ... }}`
- Returns from callback for cleanup: `return gsap.timeline()` or `return tween`
- Use `prefersReducedMotion()` helper for accessibility
- For complex scenarios (ScrollTrigger), use `createGsapContext()` in onMount

### VideoHero Pattern (from PHASE4-01)
- Use `children` prop with `Snippet` type instead of deprecated `<slot>`
- Cloudinary auto-generates poster: replace `.mp4` with `.jpg` in URL
- Cloudinary auto-generates WebM: replace `.mp4` with `.webm` in URL
- Video rotation: Use `#key currentIndex` to properly unmount/remount video element
- Always include `playsinline` attribute for iOS autoplay support

### Mobile Detection Pattern (from PHASE4-03)
- File MUST be `.svelte.ts` (not `.ts`) to use Svelte 5 runes
- Import from `$lib/utils/mobile.svelte` (without .ts extension)
- Call `initMobileDetection()` in onMount
- Use `$derived(!isMobile())` for reactive video visibility
- MOBILE_BREAKPOINT = 768px matches Tailwind `md:` breakpoint

---

## 2026-01-31 - PHASE3-01: GSAP Context Pattern and Reusable Actions

### What was implemented
- Created `src/lib/utils/gsap.ts` with:
  - `useGsap` Svelte action for GSAP animations with automatic context cleanup
  - `loadGsap()` and `loadScrollTrigger()` for dynamic SSR-safe imports
  - `prefersReducedMotion()` helper for accessibility
  - `createGsapContext()` for complex manual usage with onMount/onDestroy
- Updated `src/lib/actions/animate.ts` to use dynamic imports via `loadGsap()`
- Updated homepage to demonstrate `useGsap` action with prefers-reduced-motion

### Files changed
- src/lib/utils/gsap.ts (new)
- src/lib/actions/animate.ts (updated to dynamic imports)
- src/routes/+page.svelte (updated to use useGsap action)

### Learnings for future iterations
- GSAP context `ctx.revert()` cleans up ALL animations in scope automatically
- Dynamic import caches: `gsapInstance` pattern prevents multiple loads
- Action return object `update()` allows reactive params without re-creating context
- The `loadGsap()` helper is synchronous after first load (returns cached instance)

---

## 2026-01-31 - PHASE3-02: Splash Animation Component

### What was implemented
- Created `src/lib/components/Splash.svelte` with:
  - Full GSAP timeline animation matching nbrs.ca style
  - N-B-R-S letters animate in with stagger (scale 0→1.2→1, rotationX: 180→0, y: 100→0)
  - Uses `back.out(1.7)` easing for playful bounce effect
  - White circle expands from center to reveal main content
  - sessionStorage gating: animation only plays once per session
  - prefers-reduced-motion support: brief display then instant hide
- Integrated Splash component into `+layout.svelte`

### Files changed
- src/lib/components/Splash.svelte (new)
- src/routes/+layout.svelte (added Splash import and component)

### Learnings for future iterations
- For complex GSAP timelines with multi-phase animations, use `createGsapContext()` in onMount
- `bind:this` refs work in Svelte 5 without $state() - the warning is informational
- Circle expansion trick: use `w-[150vmax] h-[150vmax]` to ensure circle covers all viewport sizes
- Timeline chaining with negative offsets (`'-=0.1'`) creates smooth overlapping transitions
- Props in Svelte 5: `let { onComplete }: { onComplete?: () => void } = $props()`

---

## 2026-01-31 - Phase 1 & 2 Complete (Manual)

### Phase 1: Foundation & Infrastructure
- SvelteKit + Tailwind v4 + GSAP project setup
- Static adapter for Cloudflare Pages
- Video optimization pipeline (FFmpeg scripts)
- Route structure for all pages

### Phase 2: Layout & Navigation
- Scroll-responsive Nav (hides on scroll down, shows on scroll up)
- Footer with "Neighbourhood Scale" branding, SVG social icons
- Page transitions (150ms fade in/out)
- Mobile responsive (320px+)

### Gap Closure (02-03, 02-04)
- Nav polished: NBRS logo SVG, pill buttons, rollover animations, skip-to-content
- Footer polished: Large brand text, real SVG icons, americanhousing.co layout

**Learnings:**
- White logo on light background is invisible - use green logo when no dark hero
- Always create placeholder routes for nav links or build fails
- Reference quality expectations must be explicit in planning

---

## 2026-01-31 - PHASE4-01: VideoHero Component with Poster Preload

### What was implemented
- Created `src/lib/components/VideoHero.svelte` with:
  - Poster image shows immediately (preloaded via JS Image constructor)
  - Video autoplays muted after poster loads
  - WebM primary, MP4 fallback (Cloudinary URL transformation)
  - Video rotation support for multiple sources (9s interval)
  - Optional overlay class for darkening/gradients
  - Content via `children` Snippet (Svelte 5 pattern)
  - Full viewport height hero sizing
- Updated homepage with VideoHero showing 3 rotating videos from nbrs.ca

### Files changed
- src/lib/components/VideoHero.svelte (new)
- src/routes/+page.svelte (replaced with VideoHero demo)

### Learnings for future iterations
- Svelte 5: Use `import type { Snippet } from 'svelte'` for typed children props
- Svelte 5: `{@render children()}` replaces deprecated `<slot>`
- Cloudinary URL transformations: Just change file extension for format conversion
- Video poster preload: Use `new Image()` to preload, then show video element
- `#key currentIndex` forces video element remount on source change (clean swap)

### VideoSection Pattern (from PHASE4-02)
- Use IntersectionObserver with `rootMargin: '200px'` to start loading before visible
- Stop observing after first intersection (video stays loaded)
- Use `shouldLoad` state to conditionally render `<video>` element (prevents network requests)
- Fade transition: Container has `transition-opacity duration-700`, starts `opacity-0`
- SSR fallback: Check `typeof IntersectionObserver === 'undefined'` and load immediately

---

## 2026-01-31 - PHASE4-02: VideoSection Component with Lazy Loading

### What was implemented
- Created `src/lib/components/VideoSection.svelte` with:
  - IntersectionObserver-based lazy loading
  - Video only loads when in/near viewport (200px rootMargin)
  - Smooth fade transition (700ms) when video becomes visible
  - Poster image shows until video loads
  - Configurable aspect ratio via `aspectRatio` prop
  - Optional overlay class for darkening/gradients
  - Content via `children` Snippet (Svelte 5 pattern)
  - SSR fallback: loads immediately if IntersectionObserver unavailable
- Updated homepage with two VideoSection demos showing lazy-loaded content sections

### Files changed
- src/lib/components/VideoSection.svelte (new)
- src/routes/+page.svelte (added VideoSection imports and demo sections)

### Learnings for future iterations
- IntersectionObserver cleanup: Must call both `unobserve()` and `disconnect()` in onDestroy
- Use `shouldLoad` boolean to conditionally render video element (prevents network requests)
- `requestAnimationFrame` after intersection helps ensure smooth fade-in timing
- Container-level fade (`opacity-0` → `opacity-100`) + video crossfade creates polished effect
- Stop observing after first intersection to prevent re-triggering

---

## 2026-01-31 - PHASE4-03: Mobile Video Fallback

### What was implemented
- Created `src/lib/utils/mobile.svelte.ts` with:
  - `initMobileDetection()` to set up window resize listener
  - `isMobile()` reactive function returning current mobile state
  - `checkIsMobile()` for one-time checks
  - Uses 768px breakpoint (matches Tailwind `md:`)
  - SSR-safe: returns false during server-side rendering
- Updated `src/lib/components/VideoHero.svelte`:
  - Imports and uses `initMobileDetection()` and `isMobile()`
  - Conditionally renders video element only on desktop
  - Poster image stays visible on mobile (no fade out)
  - Video rotation only starts on desktop
- Updated `src/lib/components/VideoSection.svelte`:
  - Same mobile detection integration
  - Video lazy loading only triggers on desktop
  - Poster image remains as static fallback on mobile

### Files changed
- src/lib/utils/mobile.svelte.ts (new)
- src/lib/components/VideoHero.svelte (updated)
- src/lib/components/VideoSection.svelte (updated)

### Learnings for future iterations
- Svelte 5 runes (`$state`, `$derived`) require `.svelte.ts` extension, NOT plain `.ts`
- Mobile detection via screen width is more reliable than user agent sniffing
- Reactive mobile detection allows layout to adapt if window is resized
- Poster images prevent layout shift: same dimensions as video element
- SSR default of `false` for `isMobile()` means videos load on server-side render, then client hydration may hide them on mobile - this is acceptable as the alternative (SSR showing mobile view) would flash on desktop

### Mobile Detection Pattern (from PHASE4-03)
- File must be `.svelte.ts` to use runes
- Call `initMobileDetection()` in onMount of components that need it
- Use `isMobile()` in `$derived` for reactive checks
- MOBILE_BREAKPOINT = 768px matches Tailwind md: breakpoint
- Pattern: `const showVideoOnDevice = $derived(!isMobile())`

### ScrollTrigger Pattern (from PHASE5-01)
- Use `scrollReveal` action from `$lib/utils/gsap` for scroll-triggered animations
- Action signature: `use:scrollReveal={{ type: 'slide-up', duration: 0.8 }}`
- Animation types: 'fade', 'slide-up', 'slide-left', 'slide-right', 'scale'
- Options: duration, delay, distance, start, stagger, staggerSelector
- Automatically respects `prefers-reduced-motion` for accessibility
- Uses GSAP context for proper cleanup on route changes

---

## 2026-02-01 - PHASE5-01: ScrollTrigger Section Reveals

### What was implemented
- Extended `src/lib/utils/gsap.ts` with:
  - `ScrollRevealOptions` interface for configurable scroll animations
  - `scrollReveal` Svelte action using GSAP ScrollTrigger
  - Five animation types: fade, slide-up, slide-left, slide-right, scale
  - Support for staggered children animations
  - Automatic prefers-reduced-motion respect
  - Proper cleanup via GSAP context on destroy
- Updated `src/routes/+page.svelte`:
  - Added scroll reveal to About section (text slides up, video fades in)
  - Added scroll reveal to Mission section (video fades in, text slides up)
  - Added scroll reveal to bottom navigation section

### Files changed
- src/lib/utils/gsap.ts (extended with scrollReveal action)
- src/routes/+page.svelte (added scrollReveal to sections)

### Learnings for future iterations
- ScrollTrigger automatically reverts with GSAP context - no manual cleanup needed
- `toggleActions: 'play none none none'` plays once and doesn't reverse (professional feel)
- `start: 'top 85%'` triggers animation when element is 85% from top of viewport
- Subtle distances (60px slide) and durations (0.8s) feel professional
- Wrapping VideoSection in a div for scrollReveal keeps video component clean
- `power2.out` easing provides natural deceleration for reveal animations

---

## 2026-02-01 - PHASE6-01: Homepage Hero and Sections Structure

### What was implemented
- Completely redesigned `src/routes/+page.svelte` with polished homepage structure:
  - **Hero Section**: Video background with gradient overlay, two-line headline "Building Homes, Building Community", subheadline, and "Sincerely, Your NBRS" tagline. Added scroll indicator with bounce animation.
  - **FAMILY 1 Project Preview**: Left video, right content with section label, large title, description, and two CTAs (Learn More, Join Waitlist). Uses btn classes for polished interactions.
  - **How We Build Section**: Centered intro with three numbered process steps. Large faded numbers (01, 02, 03) create visual hierarchy. Steps stagger on scroll reveal.
  - **About/Mission Section**: Explains NBRS name (Neighbourhood Based Rental Solutions) with bold letter highlighting. Left content, right video.
  - **Partner CTA Section**: Full-width NBRS green section with centered headline and partner CTA button.
- All sections use scroll reveal animations with appropriate timing and delays
- Responsive layout with sm/md/lg breakpoints

### Files changed
- src/routes/+page.svelte (complete rewrite)

### Learnings for future iterations
- Section label pattern: `text-nbrs-green font-semibold text-sm tracking-wider uppercase` creates consistency
- Gradient overlay on hero: `bg-gradient-to-b from-black/40 via-black/20 to-black/50` gives depth
- btn/btn-primary/btn-secondary classes from app.css create consistent button styling
- Staggered scroll reveals: use `delay: i * 0.15` for sequential items
- Large faded numbers (text-nbrs-green/10) create visual interest without competing
- Break headlines at natural points with `<br />` for better typography
- Aspect ratio 4/5 for taller portrait videos in About section
- Partner CTA section doesn't need video - text-only with brand color is effective

---

## 2026-02-01 - PHASE6-02: Partner and Waitlist Pages

### What was implemented
- **Partner page** (`src/routes/partner/+page.svelte`):
  - Hero with green background and decorative circles
  - "Why Partner With Us" section with 3 benefit cards (Stable Returns, Community Impact, Scalable Model)
  - "Who We Work With" section with numbered partner types (Investors, Nonprofits, Landowners, Municipalities)
  - Contact form with fields: name, email, organization, partner type, message
  - Form has loading state, success state, and error handling
  - Direct email CTA at bottom

- **Waitlist page** (`src/routes/waitlist/+page.svelte`):
  - Dark hero with "Coming 2026" badge and FAMILY 1 branding
  - Feature strip showing unit highlights (3 Bedrooms, Storage Space, Outdoor Access, Vibrant Area)
  - "What to Expect" info card with waitlist benefits
  - Signup form with fields: first name, last name, email, phone, household size, neighbourhood, unit type
  - Toronto neighbourhood options (Downtown, East York, Scarborough, North York, Etobicoke, Other GTA)
  - Form validation, loading state, success state with CTA to FAMILY 1 page
  - Learn More CTA section at bottom

### Files changed
- src/routes/partner/+page.svelte (complete rewrite)
- src/routes/waitlist/+page.svelte (complete rewrite)

### Learnings for future iterations
- Svelte 5 form pattern: Use `$state()` for formData object, `onsubmit={handleSubmit}` not `on:submit`
- Use `$state<'idle' | 'success' | 'error'>('idle')` for typed submission status
- `.form-input` class from app.css provides consistent input styling with focus states
- Decorative background circles: `opacity-10` or `opacity-20` for subtle visual interest
- Partner types work well as numbered list with circular badges (1, 2, 3, 4)
- Feature strips: `grid-cols-2 md:grid-cols-4` for responsive icon/text pairs
- Blur effect for hero backgrounds: `blur-3xl` on colored circles creates ambient glow
- Privacy note at form bottom: `text-xs text-gray-500 text-center` for unobtrusive legal text

---
